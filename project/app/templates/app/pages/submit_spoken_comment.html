{% extends 'app/pages/base.html' %}
{% load bootstrap4 %}
{% load app_tags %}


{% block title %}Submit Spoken Comment{% endblock title %}



{% block content %}
  <section class='my-5'>
    <h2>
      Submit Spoken Comment
    </h2>
  </section>
  <section class='my-5'>
    <div class='col-lg-8'>
      <p>
        {% bootstrap_button "Upload" button_type='button' size='large' button_class='btn-success' id='upload-widget'%}
      </p>
    </div>
  </section>
{% endblock content %}

{% block scripts %}
  <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
  <script type="text/javascript">
    let cloudName = '{% get_env_var "CLOUDINARY_NAME"%}';
    let cloudPrefix = '{% get_env_var "CLOUDINARY_PREFIX" %}';
    let uploadWidget = cloudinary.createUploadWidget({
        cloudName: cloudName,
        uploadPreset: 'comment_video',
        sources: [
          'local',
          'url',
        ],
        multiple: false,
        folder: `${cloudPrefix}/comments`,
        resourceType: 'video',
        clientAllowedFormats: [
          'video',
        ],
        showPoweredBy: false,
        showUploadMoreButton: false,
      }, (error, result) => {
        if (!error && result && result.event === "success") {
          fetch("video-submission", {
            method: 'POST',
            body: JSON.stringify(result.info)
          }).then(res => {
            console.log('don', res);
          });
        }
      }
    )
    document.getElementById("upload-widget").addEventListener("click", function(){
        uploadWidget.open();
      }, false);
  </script>
{% endblock scripts %}
